{% extends "registration/base.html" %}
{% load i18n two_factor common_tags %}

{% block content %}
<div class="form-holder">

  <header>
    <h2>{% trans "Login to your ACCOUNT" %}</h2>
  </header>

  <form method="post" action="" class="form" id='loginform'>{% csrf_token %}

  <div class="social-accounts-login">
    {% for backend in backends.backends %}
      {% get_social_mapping backend as social %}
      <a href="{% url 'social:begin' backend %}?login_back=/login/" target="_top" class="social-icon {{ social.icon }}">
        <span class="icon"></span>
        <span class="text">{% trans social.name|custom_social_name %}</span>
      </a>
    {% endfor %}
  </div>
    
  <div class="social-accounts-login-or">
    <div>{% trans 'Or' %}</div>
    <hr/>
    <h4>{% trans 'Login with email and password' %}</h4>
  </div>
      
  {% if wizard.steps.current == 'auth' %}
  {# phase-1 (auth) = username and password #}

    {% if form.non_field_errors %}
    <p class='error'>{{ form.non_field_errors.0 }}</p>
    {% endif %}
        
    <ul>
      {% for f in wizard.form %}
      <li>{{f.label_tag}}{{f}}</li>
      {% field_errors f %}
      {% endfor %}
    </ul>

    {{ wizard.management_form }}
  
    <div class="login-line">
        <input type="submit" value="{% trans 'Log in' %}" class="btn btn-primary">
    </div>
  
  {% elif wizard.steps.current == 'token' %}
  {# ### phase-2 (token) = token from SMS or application is required ### #}

    <p class='tfa'>
      {% if device.method == 'call' %}
        {% blocktrans %}We are calling your phone right now, please enter the digits you hear.{% endblocktrans %}
      {% elif device.method == 'sms' %}
        {% blocktrans %}We sent you a text message, please enter the code we sent.{% endblocktrans %}
      {% else %}
        {% blocktrans %}Please enter the code generated by your token generator.{% endblocktrans %}
      {% endif %}
    </p>

    {% if form.non_field_errors %}
    <p class='error'>{{ form.non_field_errors.0 }}</p>
    {% endif %}
        
    <ul>
      {% comment %}
      {% for f in wizard.form %}
      <li>{{f.label_tag}}{{f}}</li>
      {% field_errors f %}
      {% endfor %}
      {% endcomment %}
      <li>
        <label for="id_token-otp_token">Verification code:</label>
        <input type="text" name="token-otp_token" autofocus="autofocus" id="id_token-otp_token" required="required" pattern="[0-9]{4,6}">
      </li>
    </ul>

    {{ wizard.management_form }}

    <div class="login-line">
        <input type="submit" value="{% trans 'Continue' %}" class="btn btn-primary">
    </div>

    {% if other_devices or backup_tokens %}
      <p class='tfa'>
        {% trans "Or, alternatively, use one of your backup phones or backup codes:" %}<br>
        {% for other in other_devices %}
          <a href='#' onclick="TFOtherDevice('{{ other.persistent_id }}')">{{ other|device_action }}</a><br>
        {% endfor %}
        {% if backup_tokens %}
          <a href='#' onclick="TFBackupTokens()">{% trans "Use Backup Code" %}</a><br>
        {% endif %}
      </p>
    {% endif %}
 
  {% elif wizard.steps.current == 'backup' %}
  {# ### phase-3 (backup tokens) = generated earlier recovery tokens ### #}
  
    <p class='tfa'>{% blocktrans %}Use this form for entering backup codes for logging in.
      These codes have been generated for you to print and keep safe. Please
      enter one of these backup codes to login to your account.{% endblocktrans %}</p>

      {% if form.non_field_errors %}
      <p class='error'>{{ form.non_field_errors.0 }}</p>
      {% endif %}
          
      {% comment %}
      <ul>
        {% for f in wizard.form %}
        <li>{{f.label_tag}}{{f}}</li>
        {% field_errors f %}
        {% endfor %}
      </ul>
      {% endcomment %}
      
      <ul>
        <li>
          <label for="id_backup-otp_token">Backup Code:</label>
          <input type="text" name="backup-otp_token" id="id_backup-otp_token" />
        </li>
      </ul>
      {{ wizard.management_form }}
  
      <div class="login-line">
          <input type="submit" value="{% trans 'Continue' %}" class="btn btn-primary">
      </div>
          
  {% endif %}

  <div class="add-holder">
      <div class="check">
        <input type="checkbox" id="rememberme" checked="checked" name="rememberme">
        <label for="rememberme" style="float: none;">{% trans "Remember me" %}</label>
      </div>
    <a class="password-help" href="{% url 'auth_password_reset' %}">{% trans "Password help?" %}</a>
  </div>
  <footer>
      <p>{% trans "Don't have an account?" %} <a href="{% url 'registration_register' %}">{% trans "Sign up for Board Director" %}</a></p>
  </footer>
  </form>
</div>

{% endblock %}
